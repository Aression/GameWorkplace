# 安装和使用指南

## 安装方法

### 方法一：使用发布版（推荐）

1. 从发布页面下载最新版本的程序压缩包
2. 解压到任意位置
3. 双击运行"连杀导出工具.exe"

### 方法二：从源码运行

1. 确保安装了Python 3.8或更高版本
2. 安装必要的依赖：
   ```
   pip install -r requirements.txt
   ```
3. 运行主程序：
   ```
   python wt_killstreak_exporter.py
   ```

## FFmpeg安装（必需）

本程序依赖FFmpeg进行视频处理。如果您的电脑尚未安装FFmpeg，请按照以下步骤安装：

### Windows

1. 访问[FFmpeg官网](https://ffmpeg.org/download.html)或[FFmpeg Windows builds](https://www.gyan.dev/ffmpeg/builds/)
2. 下载"essentials"版本
3. 解压到合适的位置（例如C:\FFmpeg）
4. 将解压后的bin目录（包含ffmpeg.exe和ffprobe.exe）添加到系统环境变量PATH中
   - 右键"此电脑" -> 属性 -> 高级系统设置 -> 环境变量
   - 在系统变量中找到Path，点击编辑
   - 点击"新建"，添加bin目录的完整路径（如C:\FFmpeg\bin）
   - 点击确定保存

或者，简单地将ffmpeg.exe和ffprobe.exe复制到本程序的同一目录下也可以正常工作。

## 使用方法

1. 启动程序后，您将看到主界面
2. 设置输入目录（录像所在文件夹）
3. 设置输出目录（导出的连杀视频将保存的位置）
4. 调整参数：
   - 击杀前保留：第一次击杀前保留多少秒（默认10秒）
   - 击杀后保留：最后一次击杀后保留多少秒（默认5秒）
   - 连杀间隔：两次击杀之间的最大间隔秒数（默认30秒）
   - 最少击杀：构成连杀的最少击杀数（默认2次）
5. 点击"开始处理"按钮
6. 等待处理完成，日志区域会显示处理进度
7. 处理完成后，点击"打开输出目录"即可查看导出的视频

### 重置处理时间戳

程序为了避免重复处理，会记录上次处理的最新视频时间点：

1. 如果需要重新处理所有视频（包括之前已处理过的），可以点击"重置处理时间戳"按钮
2. 在弹出的确认对话框中选择"是"
3. 时间戳重置后，下次运行将重新处理所有视频文件

## 故障排除

如果程序无法正常工作，请检查：

1. 是否能正确运行FFmpeg命令？在命令行中尝试执行：
   ```
   ffmpeg -version
   ffprobe -version
   ```

2. 输入目录中的视频文件命名是否符合要求？
   文件名应该类似：`War Thunder 2024.06.18 - 19.29.51.02.DVR.mp4`

3. 是否有足够的磁盘空间用于输出视频？

4. 系统是否有足够的内存和处理能力？视频处理可能需要较长时间。

## 常见问题

**Q: 为什么我启动程序后看不到任何界面？**  
A: 请确保您的电脑满足系统要求，并尝试以管理员身份运行程序。

**Q: 处理时间太长怎么办？**  
A: 视频处理是计算密集型任务。如果有NVIDIA显卡，程序会自动使用GPU加速。您也可以尝试减小处理的视频文件数量。

**Q: 我的视频文件没有被识别？**  
A: 确保视频文件命名符合"War Thunder YYYY.MM.DD - HH.MM.SS.XX.DVR.mp4"格式。

**Q: 输出的视频质量不高？**  
A: 默认使用较高的视频质量设置。如需更高质量，可以编辑源代码中的编码参数。

**Q: 状态文件保存在哪里？**

A: 取决于具体使用方式：

1. 当使用GUI版本(`wt_killstreak_exporter.py`)时：
   - 文件保存在应用数据目录中，由`APP_DIR`变量定义
   - 在Windows系统上，路径通常是：`C:\Users\用户名\AppData\Roaming\连杀导出工具\processing_state.json`
   - 完整路径通过这行代码设置：`state_file = os.path.join(APP_DIR, "processing_state.json")`

2. 当直接运行`exporter.py`时：
   - 若没有设置`STATE_FILE_PATH`，则使用默认值`STATE_FILE = 'processing_state.json'`
   - 此时文件保存在当前工作目录中

状态文件存储了上次处理的视频时间戳，这样程序可以跳过已经处理过的视频文件，避免重复处理。

您可以在GUI程序的日志区域看到具体的数据目录路径，会显示为：`[时间] 数据目录: 路径`。如需手动管理或重置处理状态，可以使用界面上的"重置处理时间戳"按钮，或直接删除此文件。